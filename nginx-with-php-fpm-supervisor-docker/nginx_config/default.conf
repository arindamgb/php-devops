upstream phpfpm-upstream {
	server php-fpm:9000;
}

server {
	listen 80 default_server;
	listen [::]:80 default_server;
	
	root /var/www/html;

	index index.html index.htm index.nginx-debian.html;

	server_name _;

	location / {
		try_files $uri $uri/ =404;
	}
	
#	location ~ \.php$ {
#            fastcgi_split_path_info ^(.+\.php)(/.+)$;
#            fastcgi_pass phpfpm-upstream;
#            fastcgi_index index.php;
#            include fastcgi.conf;
#    }

# Matches only index.php file
# location ~ ^/index\.php(/|$) {
# Matches all .php files
location ~ \.php$ {
	    fastcgi_pass phpfpm-upstream;
            fastcgi_split_path_info ^(.+\.php)(/.+)$;
            fastcgi_index index.php;
	    fastcgi_read_timeout 600;
			
	    fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
            fastcgi_param DOCUMENT_ROOT $realpath_root;
						
            include fastcgi.conf;
	    include fastcgi_params;
			
	    add_header X-Frame-Options sameorigin;
	    add_header X-Content-Type-Options nosniff;
            add_header X-XSS-Protection "1; mode=block";
	    add_header Strict-Transport-Security "max-age=31536000; includeSubdomains; preload";
			
	   #internal;
    }
}
